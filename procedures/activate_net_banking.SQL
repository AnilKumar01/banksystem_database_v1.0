USE BANK_SYSTEM

DELIMITER //

DROP PROCEDURE IF EXISTS ACTIVATE_NET_BANKING;
CREATE PROCEDURE ACTIVATE_NET_BANKING
(
	IN P_NET_BSN VARCHAR(20),
	IN P_ACCOUNT_NO VARCHAR(20),
	OUT P_STATUS INT
)
BEGIN
	DECLARE V_CNT INT;
	SELECT COUNT(*) INTO V_CNT FROM NET_BANKING_LOGIN WHERE NET_BSN=P_NET_BSN AND ACTIVATION_DATE IS NULL AND DACTIVATION_DATE IS NULL;
	
	SET P_STATUS=V_CNT;
	
	IF V_CNT=1 THEN
		UPDATE NET_BANKING_LOGIN
		SET ACCOUNT_NO=P_ACCOUNT_NO, ACTIVATION_DATE=NOW()
		WHERE NET_BSN=P_NET_BSN;
		
		UPDATE ACCOUNT
		SET NET_BANKING="YES"
		WHERE ACCOUNT_NO=P_ACCOUNT_NO;
	END IF;
END;
//
