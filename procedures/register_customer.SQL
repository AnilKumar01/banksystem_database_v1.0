USE BANK_SYSTEM
DELIMITER //

DROP PROCEDURE IF EXISTS ADD_CUSTOMER_DETAILS;
CREATE PROCEDURE ADD_CUSTOMER_DETAILS
(
	IN P_FIRST_NAME VARCHAR(20),
	IN P_MIDDLE_NAME VARCHAR(20),
	IN P_LAST_NAME VARCHAR(20),
	IN P_GENDER VARCHAR(20),
	IN P_DATE_OF_BIRTH DATE,
	IN P_MARTIAL_STATUS VARCHAR(20),
	IN P_CURRENT_ADDRESS VARCHAR(255),
	IN P_PARMANET_ADDRESS VARCHAR(255),
	IN P_QUALIFICATION VARCHAR(20),
	IN P_OCCUPATION VARCHAR(20),
	IN P_ANNUAL_INCOME VARCHAR(10),
	IN P_PAN_CARD_NO VARCHAR(20),
	IN P_EMAIL VARCHAR(60),
	IN P_MOBILE_NO VARCHAR(20),
	IN P_PHOTOGRAPH VARCHAR(60),
	IN P_SIGNATURE VARCHAR(60),
	OUT P_CUSTOMER_ID INT UNSIGNED
)
BEGIN
	SELECT COUNT(CUSTOMER_ID) INTO P_CUSTOMER_ID FROM CUSTOMER;
	SET P_CUSTOMER_ID=P_CUSTOMER_ID+1;
	INSERT INTO CUSTOMER
	(
		CUSTOMER_ID,
		FIRST_NAME,
		MIDDLE_NAME,
		LAST_NAME,
		GENDER,
		DATE_OF_BIRTH,
		MARTIAL_STATUS,
		CURRENT_ADDRESS,
		PARMANET_ADDRESS,
		QUALIFICATION,
		OCCUPATION,
		ANNUAL_INCOME,
		PAN_CARD_NO,
		EMAIL,
		MOBILE_NO,
		PHOTOGRAPH,
		SIGNATURE
	)
	VALUES
	(
		P_CUSTOMER_ID,
		P_FIRST_NAME,
		P_MIDDLE_NAME,
		P_LAST_NAME,
		P_GENDER,
		P_DATE_OF_BIRTH,
		P_MARTIAL_STATUS,
		P_CURRENT_ADDRESS,
		P_PARMANET_ADDRESS,
		P_QUALIFICATION,
		P_OCCUPATION,
		P_ANNUAL_INCOME,
		P_PAN_CARD_NO,
		P_EMAIL,
		P_MOBILE_NO,
		P_PHOTOGRAPH,
		P_SIGNATURE
	);
	
END;
//

DROP PROCEDURE IF EXISTS ADD_NOMINEE_DETAILS;
CREATE PROCEDURE ADD_NOMINEE_DETAILS
(
	IN P_CUSTOMER_ID INT UNSIGNED,
	IN P_N_FIRST_NAME VARCHAR(20),
	IN P_N_MIDDLE_NAME VARCHAR(20),
	IN P_N_LAST_NAME VARCHAR(20),
	IN P_N_DATE_OF_BIRTH DATE,
	IN P_RELATION VARCHAR(20),
	IN P_ADDRESS VARCHAR(255),
	IN P_CONTACT_NO VARCHAR(20)
)
BEGIN
	INSERT INTO NOMINEE_DETAILS VALUES
	(
		P_CUSTOMER_ID,
		N_FIRST_NAME,
		N_MIDDLE_NAME,
		N_LAST_NAME,
		N_DATE_OF_BIRTH,
		RELATION,
		ADDRESS,
		CONTACT_NO
	);	
END;
//

DROP PROCEDURE IF EXISTS REGISTER_CUSTOMER;
CREATE PROCEDURE REGISTER_CUSTOMER
(
	IN P_CUSTOMER_ID INT UNSIGNED,
	IN P_APPLICATION_CODE VARCHAR(20),
	OUT P_APPLICATION_ID VARCHAR(20)
)
BEGIN
	DECLARE V_APPLICATION_ID VARCHAR(20);
	SELECT COUNT(*)+1 INTO V_APPLICATION_ID FROM APPLICATION_FORMS;
		
	INSERT INTO APPLICATION_FORMS VALUES(V_APPLICATION_ID, P_CUSTOMER_ID, P_APPLICATION_CODE, NOW(), "PENDING");
	
	SET P_APPLICATION_ID=V_APPLICATION_ID;
END;
//
