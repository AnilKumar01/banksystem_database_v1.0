USE BANK_SYSTEM
DELIMITER //

DROP PROCEDURE IF EXISTS CASH_DEPOSIT;
CREATE PROCEDURE CASH_DEPOSIT
(
	IN P_ACCOUNT_NO VARCHAR(20),
	IN P_AMOUNT DECIMAL(10,2),
	IN P_DESCRIPTION VARCHAR(20),
	OUT P_TRANSACTION_ID INT UNSIGNED
)
BEGIN
	DECLARE V_ACCOUNT_BALANCE DECIMAL(10,2);
	DECLARE V_NEW_ACCOUNT_BALANCE DECIMAL(10,2);
	
	SELECT ACCOUNT_BALANCE INTO V_ACCOUNT_BALANCE FROM ACCOUNT
	WHERE ACCOUNT_NO=P_ACCOUNT_NO;
	
	SET V_NEW_ACCOUNT_BALANCE=V_ACCOUNT_BALANCE+P_AMOUNT;
	
	UPDATE ACCOUNT
	SET ACCOUNT_BALANCE=V_NEW_ACCOUNT_BALANCE
	WHERE ACCOUNT_NO=P_ACCOUNT_NO;
	
	INSERT INTO ACCOUNT_STATEMENTS(ACCOUNT_NO, TRANSACTION_DATE, DESCRIPTIONS, DEPOSIT, ACCOUNT_BALANCE)
	VALUES(P_ACCOUNT_NO, NOW(), P_DESCRIPTION, P_AMOUNT, V_NEW_ACCOUNT_BALANCE);
	
	INSERT INTO DAILY_TRANSACTIONS (T_AMOUNT, T_DATE_TIME, TRANSACTION_DETAIL, TO_OR_ON_ACCOUNT)
	VALUES(P_AMOUNT, NOW(), P_DESCRIPTION, P_ACCOUNT_NO);
	
	SELECT COUNT(*) INTO P_TRANSACTION_ID FROM DAILY_TRANSACTIONS;
	
END;
//
